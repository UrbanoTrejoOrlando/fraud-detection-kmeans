{% extends 'kmeans_app/base.html' %}

{% block title %}Información del Dataset{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="card-title mb-0">
                    <i class="fas fa-database"></i> Información del Dataset
                </h3>
                <button class="btn btn-sm btn-outline-primary" onclick="generateNewData()">
                    <i class="fas fa-sync"></i> Generar Nuevos Datos
                </button>
            </div>
            <div class="card-body">
                <!-- Estadísticas Principales -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stat-card text-center">
                            <i class="fas fa-table fa-2x mb-2"></i>
                            <h5>Muestras</h5>
                            <div class="stat-number">{{ num_samples }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-columns fa-2x mb-2"></i>
                            <h5>Características</h5>
                            <div class="stat-number">{{ num_features }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <h5>Transacciones Normales</h5>
                            <div class="stat-number">{{ num_normal }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card text-center" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                            <h5>Transacciones Fraudulentas</h5>
                            <div class="stat-number">{{ num_fraud }}</div>
                            <small>{{ fraud_percentage }}% del total</small>
                        </div>
                    </div>
                </div>
                
                <!-- Descripción del Dataset -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-info-circle"></i> Descripción del Conjunto de Datos</h5>
                    </div>
                    <div class="card-body">
                        <p>
                            Este dataset representa transacciones con tarjetas de crédito realizadas 
                            por titulares de tarjetas europeas. El conjunto está altamente desequilibrado, 
                            donde las transacciones fraudulentas representan solo el {{ fraud_percentage }}% 
                            de todas las transacciones.
                        </p>
                        <p>
                            <strong>Características principales:</strong>
                        </p>
                        <ul>
                            <li><strong>V1-V28:</strong> Componentes principales obtenidos mediante PCA</li>
                            <li><strong>Time:</strong> Segundos transcurridos entre cada transacción</li>
                            <li><strong>Amount:</strong> Monto de la transacción</li>
                            <li><strong>Class:</strong> Variable objetivo (1 = fraude, 0 = normal)</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Estadísticas Detalladas -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Estadísticas Descriptivas</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Característica</th>
                                        <th>Media</th>
                                        <th>Desviación Estándar</th>
                                        <th>Mínimo</th>
                                        <th>Máximo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for col, stats in dataset_info.describe.items %}
                                    <tr>
                                        <td><strong>{{ col }}</strong></td>
                                        <td>{{ stats.mean|floatformat:4 }}</td>
                                        <td>{{ stats.std|floatformat:4 }}</td>
                                        <td>{{ stats.min|floatformat:4 }}</td>
                                        <td>{{ stats.max|floatformat:4 }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function generateNewData() {
    const n_samples = prompt("¿Cuántas muestras desea generar? (default: 5000)", "5000");
    const fraud_ratio = prompt("¿Qué porcentaje de fraudes? (default: 0.0017)", "0.0017");
    
    if (n_samples) {
        $.get(`/generate-data/?n_samples=${n_samples}&fraud_ratio=${fraud_ratio}`, function(data) {
            if (data.status === 'success') {
                alert('¡Datos generados exitosamente!\n\n' +
                      `Muestras totales: ${data.num_samples}\n` +
                      `Transacciones normales: ${data.num_normal}\n` +
                      `Transacciones fraudulentas: ${data.num_fraud}\n` +
                      `Porcentaje de fraudes: ${data.fraud_percentage}%`);
                
                // Recargar la página para mostrar los nuevos datos
                location.reload();
            }
        });
    }
}
</script>
{% endblock %}